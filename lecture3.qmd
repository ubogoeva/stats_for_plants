---
title: "R и статистика в селекции: лекция 3"
subtitle: 'Введение в статистику'
author: "Elena U"
#date: "Created on 01 April, 2023"
execute:
  echo: true
  output: true
format: 
  revealjs:
    slide-number: c/t
    show-slide-number: all
    # mainfont: Arial
    # fontsize: 14px
    theme: [default, custom.scss]
    chalkboard: 
      buttons: true
    # theme: [serif]
    # mouse-wheel: true
    auto-play-media: true
    width: 1280
    height: 720
    fig-dpi: 300
    # logo: figures/icg.png
revealjs-plugins:
  - pointer
css: styles.css
editor: visual
filters: [bg_style.lua]
draft: true
---

## План лекции

-   О чем статистика? Описательная и статистика вывода.

-   Типы переменных и типы шкал.

-   Понятие генеральной совокупности и выборки.

-   Описательные статистики.

-   Практика в R.

## Данные для работы

```{r}
library(tidyverse)
library(readxl)
df <- read_xlsx('data/ANOVA single location EPBA6.xlsx')
head(df)
# альтернативно можно прочитать гугл таблицу с гугла диска
# library(googlesheets4) # для чтения гугл таблиц с гугл диска
# df <- read_sheet('https://docs.google.com/spreadsheets/d/1KOOgXPipcaa7WWRxgBCrEGbNfrgW8JV0L-z2UvHk1pE/edit#gid=402013081') # понадобится зайти в гугл

```

## Предмет статистики

Вообще, статистика делится на два блока:

-   Описательная статистика (*descriptive* statistics)\
    Описываем имеющиеся у нас данные с помощью статистик, например среднее, медиана, дисперсия, стандартное отклонение и тп.

-   Статистика вывода (*inferential* statistics)\
    Пытаемся сделать вывод о всей генеральной совокупности данных. Например, стандартная ошибка, доверительный интервал и различные тестовые статистики - t-статистика, F-статистика, $\chi^2$-статистика.

## Статистика вывода в селекции

::: incremental
-   Оценка результатов селекционной работы: \
    Статистика вывода помогает оценить, насколько хорошо новые линии / сорта / гибриды соответствуют поставленным селекционным целям.

-   Принятие решений: \
    Статистический анализ данных помогает селекционерам принимать обоснованные решения о том, какие генетические материалы следует продолжать использовать в дальнейшей работе, а какие следует исключить.

-   Сравнение кандидатов: \
    Статистически обоснованно сравнивать разные линии / сорта / гибриды между собой, что помогает определить наиболее перспективные для дальнейшего использования.
:::

## Что такое генеральная совокупность?

::: incremental
-   Генеральная совокупность --- совокупность всех объектов (единиц), относительно которых предполагается делать выводы при изучении конкретной задачи.

-   Генеральная совокупность состоит из всех объектов, которые имеют качества, свойства, интересующие исследователя.

    Например: все клетки определенной клеточной линии, все растения определенного сорта.
:::

## Что такое выборка?

-   Выборка --- часть генеральной совокупности элементов, доступная для исследования.

    ![](images/image-1460015740.png)

То есть на основании *выборки* растений, которые мы посадили для исследования, мы хотим обобщить выводы на всю *генеральную совокупность* растений выбранного сорта.

## Параметры и статистики

Population - генеральная совокупность.

Sample - выборка.

|                          |                                                                                |
|--------------------|:---------------------------------------------------|
| [P]{.underline}opulation | [P]{.underline}arameter (обозначают греческими буквами: $\mu$, $\sigma$.       |
| [S]{.underline}ample     | [S]{.underline}tatistics (обозначают латинскими буквами: $\overline{x}$, $sd$) |

Например, у стандартного нормального распределения среднее $\mu$ 0 и стандартное отклонение $\sigma$ 1, и эти значения являются *параметрами*, поскольку описывают теоретическое распределение (генеральную совокупность).

Например, в датасете `df` среднее по `YEILD` равно 81.1, а стандартное отклонение 9.52, и эти значения являются *статистиками*.

```{r}
mean(df$YIELD) 
sd(df$YIELD)
```

## Классификация выборки

-   По принципу отбора:

    -   Независимые (растения разных сортов / гибридов);

    -   Зависимые (например одни и те же растения на разных стадиях развития).

-   По корректности отбора:

    -   Репрезентативные;

    -   Нерепрезентативные.

-   Основные стратегии отбора:

    -   Простая случайная выборка

    -   Стратифицированная

## Типы переменных и типы шкал

::: incremental
-   Количественные

    -   Непрерывные (высота растений, масса, длина корня)

    -   Дискретные (количество зерен в колосе, количество соцветий)

    -   Ранговые (степень поражения болезнью, сладость томатов по шкале brix)

-   Качественные (категориальные, номинативные)

    -   Бинарные (есть мутация или нет, наличие устойчивости к болезни)
:::

## Классификации типов переменных

По дизайну эксперимента

-   Независимые переменные - то, влияние чего мы хотим изучить (сорт, густота посева, срок посева, генотип). Выбирается экспериментатором.

-   Зависимые переменные - то, что мы измеряем в исследовании (урожайность, рост, экспрессия генов)

Важно для проведения статистических тестов, записи формулы линейной модели.

Например:

```{r}
#| eval: false
lm1 <- lm(YIELD ~ Pedigree, data = df)
```

`YEILD` -- зависимая переменная, `Pedigree` -- независимая.

## Как можно описать значения в выборке?

Описательные статистики:

-   Меры центральной тенденции

-   Меры изменчивости

## Меры центральной тенденции

-   Среднее - среднее арифметическое всех значений (сумма всех значений, деленная на количество).

-   Медиана - середина упорядоченного ряда значений.

-   Мода - наиболее часто встречающееся значение в выборке. Обычно актуально для категориальных переменных.

```{r}
mean(df$YIELD) # среднее
median(df$YIELD) # медиана
```

Для вычисления моды можно использовать функцию `dplyr::count()`.

## Меры изменчивости

-   Размах -- разность между максимальным и минимальным значениями.

-   Межквартильный размах -- разница между верхним и нижним квартилем.

-   Дисперсия -- сумма квадратов отклонений, деленная на их количество.

    ::: callout-note
    Отклонение -- это разность между средним арифметическим и конкретным значением.
    :::

-   Стандартное отклонение -- квадратный корень из дисперсии.

## Межквартильный размах или как интерпретировать боксплот

Боксплот или ящик с усами.

![](https://i.ytimg.com/vi/BE8CVGJuftI/maxresdefault.jpg)

## Формула дисперсии и стандартного отклонения

Дисперсия (variance) генеральной совокупности:

$$
\sigma^2 = \frac{\sum_{i=1}^n(x_i - \overline{x})^2}{N},
$$

где $\sigma^2$ - среднее, *N* - количество элементов в выборке

Стандартное отклонение (standard deviation, $\sigma$, sd)

$$
\sigma = \sqrt{var} =\sqrt{\frac{\sum_{i=1}^n(x_i - \overline{x})^2}{N}}
$$

При вычислении дисперсии и стандартного отклонения для выборки в формуле в знаменателе *N-1*.

$$
sd =\sqrt{\frac{\sum_{i=1}^n(x_i - \overline{x})^2}{N-1}}
$$

## Расчет дисперсии и стандартного отклонения в R

```{r}
var(df$YIELD)
sd(df$YIELD)
```

По умолчанию функции `var()` и `sd()` считают для выборки - в знаменателе N-1.

## Оценки среднего генеральной совокупности

Стандартная ошибка

Доверительный интервал

## Нормальное распределение

Непрерывное распределение вероятностей с пиком в центре и симметричными боковыми сторонами, которое в одномерном случае задаётся функцией плотности вероятности, совпадающей с функцией Гаусса.

```{r}
set.seed(1)
norm_distr <- rnorm(10000)
hist(norm_distr, freq = FALSE)
lines(density(norm_distr))

```

## Нормальное распределение

![](https://upload.wikimedia.org/wikipedia/commons/thumb/8/8c/Standard_deviation_diagram.svg/1200px-Standard_deviation_diagram.svg.png){width="522"}

## Центральная предельная теорема

Согласно центральной предельной теореме (ЦПТ, *central limit theorem*), какой бы ни была форма распределения в генеральной совокупности, **выборочное распределение средних** будет стремиться к нормальному. При этом чем больше размер выборки, тем ближе выборочное распределение средних будет к нормальному.

## Центральная предельная теорема

Используем лог-нормальное распределение:

```{r}
hist(rlnorm(10000), breaks = 100)

```

------------------------------------------------------------------------

Как будут распределены средние из лог-нормального распределения?

```{r}
many_means <- replicate(1000, mean(rlnorm(10000)))
hist(many_means, breaks = 100)
```

Они будут распределены нормально!

## 
